<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hi teachers wsg? Teachers please follow my X @InknBoyM thankns.</title>
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
        import { getDatabase, ref, onChildAdded, push } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-database.js";
        import { getAuth, signOut } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-auth.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCUD9YE6_Uz3x0JrqYWV081ojwiluGrxO0",
            authDomain: "test-e95c8.firebaseapp.com",
            databaseURL: "https://test-e95c8-default-rtdb.firebaseio.com",
            projectId: "test-e95c8",
            storageBucket: "test-e95c8.firebasestorage.app",
            messagingSenderId: "496018778332",
            appId: "1:496018778332:web:14a98835a299179e3a6c19",
            measurementId: "G-ZVZEQDN22X"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const auth = getAuth();

        // DOM Elements
        const loginForm = document.getElementById("loginForm");
        const chatContainer = document.getElementById("chatContainer");
        const chatBox = document.getElementById("chatBox");
        const messageInput = document.getElementById("messageInput");
        const sendButton = document.getElementById("sendButton");
        const fileInput = document.getElementById("fileInput");
        const logoutButton = document.getElementById("logoutButton");
        const usernameInput = document.getElementById("usernameInput");

        let username = "";

        // Handle the login form
        loginForm.addEventListener("submit", (e) => {
            e.preventDefault();
            username = usernameInput.value.trim();
            if (username !== "") {
                loginForm.style.display = "none";
                chatContainer.style.display = "block";
                loadMessages();
            } else {
                alert("Please enter a username.");
            }
        });

        // Logout function
        logoutButton.addEventListener("click", () => {
            username = "";
            loginForm.style.display = "block";
            chatContainer.style.display = "none";
            chatBox.innerHTML = "";  // Clear chat box on logout
        });

        // Load messages from database
        function loadMessages() {
            const messagesRef = ref(database, "messages");
            onChildAdded(messagesRef, (snapshot) => {
                const message = snapshot.val();
                const messageElement = document.createElement("div");

                if (message.image) {
                    messageElement.innerHTML = `<strong>${message.username}:</strong> <br><img src="${message.image}" width="200">`;
                } else {
                    messageElement.textContent = `${message.username}: ${message.text}`;
                }

                chatBox.appendChild(messageElement);
                chatBox.scrollTop = chatBox.scrollHeight;
            });
        }

        // Send message function
        sendButton.addEventListener("click", () => {
            const text = messageInput.value.trim();
            if (text !== "") {
                push(ref(database, "messages"), { username, text });
                messageInput.value = "";
            }
        });

        // Send image function
        fileInput.addEventListener("change", () => {
            const file = fileInput.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onloadend = () => {
                    push(ref(database, "messages"), { username, image: reader.result });
                };
                reader.readAsDataURL(file);
            }
        });
    </script>

    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        #chatContainer { display: none; }
        #chatBox { width: 80%; height: 300px; border: 1px solid #ddd; overflow-y: auto; margin: 10px auto; padding: 10px; text-align: left; }
        #messageInput { width: 70%; padding: 10px; }
        #sendButton, #logoutButton { padding: 10px; cursor: pointer; margin-top: 5px; }
        input, button { margin: 5px; padding: 8px; }
    </style>
</head>
<body>

    <h2>chatty</h2>

    <!-- Username Input Form -->
    <form id="loginForm">
        <h3>Enter Your Username</h3>
        <input type="text" id="usernameInput" placeholder="Enter your username" required><br>
        <button type="submit">Join Chat</button>
    </form>

    <!-- Chat Container -->
    <div id="chatContainer">
        <button id="logoutButton">Log Out</button>
        <div id="chatBox"></div>
        <input type="text" id="messageInput" placeholder="Type your message...">
        <button id="sendButton">Send</button>
        <input type="file" id="fileInput" accept="image/*">
    </div>

</body>
</html>
